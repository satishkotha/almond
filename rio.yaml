schemaVersion: 2.0

timeout: 30

machine:
  env:
    RUNTIME_JDK_VERSION: 11
    SBT_OPTS: -XX:MaxMetaspaceSize=4096M

builds:
  - name: almond-0.8.2-publish
    branchName: 0.8.2
    build:
      template: buildozer:v4:publish
    package:
      release: true
      libraries: true
    finally:
      tag:
        expression: '${APP_VERSION_1}-${RIO_BUILD_NUMBER}'

  - name: almond-0.8.2-docker
    branchName: 0.8.2
    build:
      template: buildozer:v4:publish
    package:
      dockerfile:
        - dockerfilePath: ./Dockerfile
          name: almond-oss-docker
          perApplication: false
          publish:
            # Publishes to the specified repos and to the Compute namespace.
            - repo: docker.apple.com/com.apple.pie.spark.ds/spark-almond-oss-kernel
      mirror:
        target: silkroad